#!/usr/bin/env bash

bin/console doctrine:database:drop --force --if-exists
bin/console doctrine:database:create --if-not-exists
bin/console doctrine:schema:update --force
bin/console doctrine:fixtures:load -n

export $(cat .env | grep JWT_PASSPHRASE | xargs)
mkdir -p config/jwt
openssl genrsa -passout pass:${JWT_PASSPHRASE} -out config/jwt/private.pem -aes256 4096
openssl rsa -passin pass:${JWT_PASSPHRASE} -pubout -in config/jwt/private.pem -out config/jwt/public.pem
echo "RSA key pair successfully generated"
